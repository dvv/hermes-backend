# @author Igor compiler
# @doc Compiler version: igorc 2.1.4
# DO NOT EDIT THIS FILE - it is machine generated

defmodule WebProtocol.HermesProjectService.Impl do

  @behaviour WebProtocol.HermesProjectService

  # ----------------------------------------------------------------------------

  defmacro __using__(which) when is_atom(which), do: apply(__MODULE__, which, [])

  def router() do
    quote do
      match "/api/projects", to: WebProtocol.HermesProjectService.Projects
      match "/api/projects/:id", to: WebProtocol.HermesProjectService.Project
    end
  end

  # ----------------------------------------------------------------------------

  @doc """
  Get projects
  """
  @spec get_projects(
    session :: any()
  ) :: DataProtocol.Collection.t(DbProtocol.Project.t())
  @impl true
  def get_projects(
    session
  )
  do
    unless Hermes.can_get_projects?(session), do: raise DataProtocol.ForbiddenError
    items = Hermes.get_projects()
    %DataProtocol.Collection{items: items}
  end

  # ----------------------------------------------------------------------------

  @doc """
  Get a project
  """
  @spec get_project(
    id :: integer,
    session :: any()
  ) :: DbProtocol.Project.t()
  @impl true
  def get_project(
    id,
    session
  ) when
    is_integer(id)
  do
    unless Hermes.can_get_project?(session), do: raise DataProtocol.ForbiddenError
    item = Hermes.get_project!(id)
    # log_user_action(session, :read, item)
    item
  end

  # ----------------------------------------------------------------------------

  @doc """
  Create a project
  """
  @spec create_project(
    request_content :: WebProtocol.CreateProjectRequest.t(),
    session :: any()
  ) :: DbProtocol.Project.t()
  @impl true
  def create_project(
    request_content,
    session
  ) when
    is_struct(request_content, WebProtocol.CreateProjectRequest)
  do
    unless Hermes.can_create_project?(session), do: raise DataProtocol.ForbiddenError
    item = Hermes.create_project!(Map.from_struct(request_content))
    # log_user_action(session, :create, item)
    item
  end

  # ----------------------------------------------------------------------------

  @doc """
  Update a project
  """
  @spec update_project(
    request_content :: WebProtocol.UpdateProjectRequest.t(),
    id :: integer,
    session :: any()
  ) :: DbProtocol.Project.t()
  @impl true
  def update_project(
    request_content,
    id,
    session
  ) when
    is_map(request_content) and
    is_integer(id)
  do
    unless Hermes.can_update_project?(session), do: raise DataProtocol.ForbiddenError
    item = Hermes.update_project!(id, request_content)
    # log_user_action(session, :update, item)
    item
  end

  # ----------------------------------------------------------------------------

  @doc """
  Delete a project
  """
  @spec delete_project(
    id :: integer,
    session :: any()
  ) :: DataProtocol.GenericResponse.t()
  @impl true
  def delete_project(
    id,
    session
  ) when
    is_integer(id)
  do
    unless Hermes.can_delete_project?(session), do: raise DataProtocol.ForbiddenError
    item = Hermes.get_project!(id)
    :ok = Hermes.delete_project!(id)
    # log_user_action(session, :delete, item)
    %DataProtocol.GenericResponse{result: true}
  end

end
